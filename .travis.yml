sudo: required
services:
- docker
language: node_js
node_js:
- 8
cache:
  yarn: true
  directories:
  - node_modules
stages:
  - lint
  - test
  - name: docker
    if: branch = master
  - name: deploy
    if: branch = master
jobs:
  include:
  - stage: Lint
    script: npm run linter:js
  - stage: Test
    script: npm test -- --coverage
    after_script: cat coverage/lcov.info | node_modules/.bin/coveralls
  - stage: Docker
    script:
    - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD $DOCKER_REGISTRY
    - docker build . --tag $DOCKER_REGISTRY/$REPO
    - docker push $DOCKER_REGISTRY/$REPO
  - stage: Deploy
    before_deploy:
    - openssl aes-256-cbc -K $encrypted_ecd7d71f89bf_key -iv $encrypted_ecd7d71f89bf_iv
      -in deploy_rsa.enc -out deploy_rsa -d
    - chmod 600 deploy_rsa
    script: skip
    deploy:
      provider: script
      skip_cleanup: true
      script: ssh -i deploy_rsa $DEPLOY_USER@$DEPLOY_HOST "sh ${DEPLOY_PATH}/bin/update homepage"
env:
  global:
  - secure: j2vFiTulNGNIGkRdfYTp1NKkcA933vFC9cRTL2d03KQWyUb8lddvIiergZtwXWlZIVHzwsEZevTTUpQx4kOqYl4l9k4zKjxVEhG68AipDL/5L6otLsqQLih2IeJO2WTPAY9NjcfyWWmxmlksvFVeuwzkijBTXP9dKBLE+VKBcKHwaAfXFcxYJwYcsMJRmyzRcLPLwHiguTtygCwuf4has7Z1YjviLzDrW8UXsF9lglz4R6YhGI83yS8eg4eoaD904/vlS4PaCE1My14hRI5PAQH7MX/FcAf7OMwcpyqzWCydBTWA2vUId3ZYK/qtQxM8otMKsE3RC2Yh7we0DpFrni8JuiQjKfy9b0R+JjEu0wQ6h4uaV3W5W1vWE8DA2iMXdI/G15SrQI1QzgOUcrzqc1YK9FoXSN3puBYbftobCyOgNAp664rhLVOx4Eh6ydXeiJc2tkswamU33c1cxqlLzuzyBDHpVqhCXe5XGTF8eJroj6fdbjzWzQhnW7wkt0C37OSFuVt0H9gQWYEU9pZecG4NsxqJVj/ZC96nTdWhyH4jJTqFsL7hslNiXzs2DSzdVCURY+fKZzoOiMHNUjuowsN0uAH9rBD5EqynFHplikwxp9OKqaJTj9XlhbZAqVDXmeDBljqTbWQZX0p85WwOn3w2BPc8uUChd3CgSCo+kLI=
  - secure: BPGOTm2YD4paBC9Qip3WBBzt24L5GLv4rmuS4DYXARcGf+DujFVcmWjBK9FEG77NrnPYhr09P2LY+x6CLaVaNcUtggHY9s17OwgN6n6iheOtCtHQ4TDlR0q2SSGfVJuFvp6DA+CRtF5IfEqnXQMy3bqbR4pxwNzB1OI5NFjkK6Yf83rHyHXnhjMb5PZrqSRWNhoZUP9syQ8SwGIayu37hgpRoe5pgh1RwP9ZwQZxLIbCZX+FHQdpNdhRiKDa2t2QziVmdj+8jcxC/kR6NRKk54rtCok2jl4gd4+CEF3P0DunxzzLgr2viywWpPCTS5tJYEyOs2Qg0k7Eo0ubVPGHqLeyIzZWwLSBsOfkRFw5U4k3tQ/r8D1T2KgqwjajfU2a1bceWTXl4ekWZ1pxpxnuB5snem0+8summpOYNcQ2tCtcTe0Oimsn8xlcxsBX2NRDgVVfqFAnAEZwfeLwBpYjENupZPnDmgI2Xq+y7ZbBl+nUDZSB7yWIkpHCoJHdFVz4peDr44T3FkwmcFr1HOvC0kiLM8JOQIUIUIdcC27/Mkh9T/Thq7yGdL1FzpRQbH/zmLWwP0BH7Somp1YVaVnoPJFujdccDwNQrqwJ5mXMUK59GzjWweLp2fPZOlGB1+mklrlP2zU7Nti33b7wfDfGU2LnbGCZUH2EKfT4jxKEyLM=
  - secure: zRCNRiM28T6cI0rtgBBpR1u/Gdh6VY0dUEXg/f5LXFQK2LLqqEZl+dJtNRLxf7+wH/KNBEqelXuNcreV/uSbnvu+J5/K15qfgCY1a0T+rgjfTLsNW3Ps0HZdoYb1E/ymT7+E8/R9bZV2ggoHeMGDG04rlsw9/MYn5WW0y044FHGlnLwpFq50r6gp9k6D6jnkqiP3/XPiMVRL02Y11sEHQydBcBXlYwHj8kHpcfX3TMbwZTSd2qsUzyxPOjwsVsLhBDRZjdLf5eo1981tYYTOK3PmusjqAPFYTUKfuUOx9oh3WkrmLYTFz63tcynPI2bOUMU3WnrDY2ezpXSUPOt/8h5q2Sz8HSSAJhiCFi9wGNDrAAkNhAO/ElrywtmDvYMuXTK8+7mgWGi4ZmlV3h5ziuJChiWAzbtqKzqhUC0UcK9hCfo94+qVQ2Sh0jmOmD+EsyIqgBkINXpkYs2GugK63ZAV1ApMv5iXl2yOz2DEND+P177p0DZeTByrMZEOXDlRZtp9SVATYXBKXO62ykQbzEey6MeJkacMXFL/IVTbyIegyC7j5Zn605ZctonZQDDuHLahon+Gmehdu5di+rTe85Hg7MFi726jjD7pNU2AAPa/s5LrZdjDMzhqbgTmNyxpLa0o5EpVlcRL/ujKn7cqVawUbPjHlujnh/QDhwEllJY=
  - secure: KTYCOtXZRFRdmHBMdxs/R+nydiRuoS9ZekyF+6S/t+877zVNs2EJG0Ay1P2fqrEXG+hTqf2cMVwFUko4h2u+cYw3WU+9QPl3zRpUtQlygW+NIxc4ZxHBjMuvCwgImhh/3OqSWMgObKDDboAIWBDYbYJ+GXwXOYUNy1V1ceD8XVRzFKfSOnjY8e+pU50Dl/GqMGePP6M2a3wAsI4cvL/cW5VmxITmBJOmldKd60PPgtZEKhaUAL8SFvFsd9SUEmUZhDWOhw1hb0tEF9uItDKJc+L3NnztbgH4jHoEbd2gb76kJzOKDUfWtyS7UbR1h9M8/5GHbh4IMHBhzJN6ftmRDnO+ot8K7f/6EVP9V/QA6quv7iQMQXRlgBd2npHEHDYVXEicZbH5DUKPo93u1GeyZd54r/7PGeGXaegnzBXHvi/E55VqreYcDgERVSci6VF3AyWaNmtzZcKhaGLRwtGlAIO59rUCPO34qPrHaZkQKGGZHwvEPatLHzWlllepfUSH/NU0F/qL270t7uSo5ZXBE2N5EvfptL4ELj3kE73wQTcgJJPZOVLICoLtyykemWVANsuAzFzcmGIXRdgF9X8Wbf8ggOcglivH/7qE6zoi5BepyK22JkelfFI2mQsM/EOM883y6X0pbkeOhcXNXkA/bjfLX/oIVKCDQdvv50umWWo=
  - secure: zEDeTOPAyifNfrslrE7YhF2/5B4uI3DxTfXUv6xaEQetiT4Afwobp9qBl2tUMssMgEHFX7hhZTtRms/SK6T9RHXaeMMz/LLKz8vngmIcNY/ll5vwVJIIWQoF4pRnh/s9GQi1bKA4obxWrYurx+33RbwQ6l3geuVHjdT8D78JPgtrpuApKX5BsxXZnMI/swLBYdyBgEGGPFrmoplq3p4EVNkn7RUCsA0lh0hv7vn8ycFxzMLPUfQIOhiSGncxeWqInG8tR1dNKSeSDxvdy+VQU5t7D3NhphrWqY1H1Nolple7Gwb+X0gvTgyP83+0Ypp1kKP0kPuNBqn5benA3M3pbd3tthmEHOP71wfzMzmRN03ck6CietpW6tGjiromYiXDCVz4NZ5ERiXy1131fkwgdkF7TH6ki4UvTdzsrJ1E4OzKbX+H9JvRTkf8QDdwvNwtgTgY1N0vtv93kxApDfmqGS9zCcaGim3uBoeydpwhR6V8d+hTDfWCtDKDxO/uo0Tn6ZGQkqAZU6FR18DVkGgwsCZdlmFrjMaITPLDV0I05fbty/Qle2d2sWIjhMgDAViIg8mtnEca4MKhe0ahn/fLhwwVulrNnmXa0BdrcPEdMNv1lvAQt2MCa3c472r5HudvM5i9VrS0qniRhESoy2fUeWt0Vw8R8SujyP1JwAuwExE=
  - secure: PfCGNjgZy33UpliCDIz0F/UPjY2LZtcgAbG50ZpDQPqbNWQD7a+tw3upPzestmc1ugFLY6hEHxl+Og+8mILKY4LnrxjRdBDRlvnbyeK2LOspM6qK04VbCxKEOamyOW8lRnTfnA1pDHUaG4eeMj36J6Hvwd/da4xbo/IyGwhXZIJ5bPfkvEp24f9ND7clFuZtqhYU2HsDy/moP6rAfCYJ07ktI/6CVqR4w4lVsHGvjPtczQvJ2+vBhzh5ig6F/h+0zBubldpUEzxmmpJVst5q5pr9fgz+6tIeEY7dNvZj+c8f0jFEc++inJpA53y1e3QSjhJ9L7jNPezlC9duDTYPFeJSMybHaMFCWqvswf+APa/5c6wS24WMZxMe6pk72zYhmgqPqzQPRXnVaZJcVgCtSxMw1tgMR9URb/LLfX2n9ZrjaZruCuQ7fBmutt/QHoXLqbISD/22Re9QWAmiOYeozfKT91BJH0hr8H6LQV/IQQekgLsh18UEI2FyOOuFqNp+s/LNlUFFeweb/Ftk8AoRQUbYzS9AEOdDTt3kLTPMf8U/RWCPxC83XX+AZzyO3A47D70REcgLWMHu7RdiCF6tMpiCkKsRoR3Q9lNia1+UwLOBrD8JRdEoq4+E43/9wrTwnQf28dnJ5en7b1OOUzPbQOaeheCn5ReqFqgER2UwIyg=
  - secure: SfbL2RbkRZ8Sy5F/tM6FkIxUwL9NU7CBVv4Wm9LgjSz+ILzf9TZCjZZkUp5AkYKQdHiCc4qXXsm4kM7xVdxv3RSu6tIz1QasowUgjowMm8T700GaptuOY54rHJKwQ4A8rTYf7gRzcu65SYW+jttZNolP1OTpCe91I/jrvvUPazSrHWKfX7aAinfnSeJbh2227qWqCwB5VjCbvE/gqGhxzvVLCxXgjk9qzazsSHxwetXKsg4ZR8xzerxuguIg79323yzMQspJOz+nm0e4o2ezV6OIlZSQoldesb+Hg2TOgQXgYnRyKdxy3ZZitTPdS9IkNtjz93mU8AZULc+UXW6SmCweuIbfuhaRopLLEMmT/84gD9Gb6RKmlaDs+kCkogZAiE6J3A1k+fSiiREIw4RHCdK77BL9d8Wg0X7+UkK+p640n2WFqCrJpUjHtyFgm4Fo8zrgFvTzObVZ0y8jmSYBw8psWI7Siihm6z3TXnMAJAb0PzaM5IUD9NX6YbREqHyh1/EtP0fQhkKrouZ615hhZx3PVeObFyMVXkoL3zgG8QRJs34ObWit9eXL/AwfA7vzSaNYKPsmJF7MY+IukPCnHEcynTF+xbsaTLGl8KKM9UVEBfx7FhQRqtxoLhY/PR+2+w6YVEmLjXhM9U/ShJmC3i0eqrn9pSifNM/AY2Xk/pY=
addons:
  ssh_known_hosts:
    secure: mTVtWkSDLm2bJ3mi2Pm4iMVtuIYC7I2eHGChd4GScjY+8gA5bnxRQBs0LHp5Jzds0ZF2yButZX997NAG4HNjPSWutdk/gqZVhXWDlMHt6BXnGm38woN/NjXCD6OFFl3T3kqh1C+8T1CUaUF66AxDJfXKDmCNiHedAJUiy9viIk/6rBN7bExO0rJpSFbJUV+SlV1Eun8aou60h+TlQ91iaiGMDIUOYXGHMLl3MNsLHK5Wd/Yx4MTFTs4oBmOf93CPH1XTa+XymASFOMiLtohJO/RYRYHtxSk+AAHDocQFqqyydNIpJ+rB3I5Th1WG6JgOz1K6VQ17VJWKVzCbZk6vOjAOz+45+rcBWUHCafV2OuDJp5G5Y9GdTzZ1uAY806Oe+IEpHxcwpJ3nKwPvLeKowXUSh0dgI8vEOpTgIPwILfoUudWWDdIZ4q4+DTsFfvd5FAf9/o+v6s3qpxhh39jASp3DxnCBhJCfkVzITBJuAkFylrz+j6yVveH4SGm6CGDo5+FcWhfZ5AestQItmVHFEgMhJNaOnN+gzN34bDTrlg29ncXjgAMvMnfxb4dgFGIXftqawi3gofEtXOJO2Pk3Sv7RpohijN27LcLqf2cPUImpNMsdiYPlgMsVx30/j2hqyXzq6MlZR82hBR1FXXPZk3fMRgiRTG0F0EHiN+TwVhw=
